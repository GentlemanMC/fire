package dev.zprestige.fire.module.exploit.chorusmanipulator

import dev.zprestige.fire.event.bus.EventListener
import dev.zprestige.fire.event.impl.PacketEvent.PacketSendEvent
import net.minecraft.network.play.client.CPacketConfirmTeleport
import net.minecraft.network.play.client.CPacketPlayer

class PacketSendListener(chorusManipulator: ChorusManipulator) : EventListener<PacketSendEvent, ChorusManipulator>(
    PacketSendEvent::class.java, chorusManipulator
) {
    override fun invoke(e: Any) {
        val event = e as PacketSendEvent
        if (module.chorussed) {
            if (event.packet is CPacketPlayer) {
                module.packets.add(event.packet as CPacketPlayer)
                event.setCancelled()
            }
            if (event.packet is CPacketConfirmTeleport) {
                module.tpPackets.add(event.packet as CPacketConfirmTeleport)
                event.setCancelled()
            }
        }
    }
}
