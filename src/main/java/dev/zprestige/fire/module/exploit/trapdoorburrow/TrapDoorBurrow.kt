package dev.zprestige.fire.module.exploit.trapdoorburrow

import dev.zprestige.fire.Main
import dev.zprestige.fire.event.bus.EventListener
import dev.zprestige.fire.module.Descriptor
import dev.zprestige.fire.module.Module
import dev.zprestige.fire.settings.impl.Slider
import dev.zprestige.fire.settings.impl.Switch
import dev.zprestige.fire.util.impl.BlockUtil
import net.minecraft.util.EnumFacing
import net.minecraft.util.EnumHand
import net.minecraft.util.math.BlockPos
import net.minecraft.util.math.Vec3d

@Descriptor(description = "Burrows you with a trapdoor to bypass 2b2tpvp")
class TrapDoorBurrow : Module() {
    val fallSpeed: Slider = Menu.Slider("Fall Speed", 1.0f, 1.0f, 20.0f)
    val instant: Switch = Menu.Switch("Instant", false)
    val instantFactor: Slider =
        Menu.Slider("Instant Factor", 20.0f, 1.1f, 500.0f).visibility { instant.GetSwitch() }
    var opened = false
    var pos: BlockPos? = null
    var savedPitch = 0f

    init {
        eventListeners = arrayOf<EventListener<*, *>>(
            TickListener(this)
        )
    }

    override fun onEnable() {
        pos = BlockUtil.getPosition()
        opened = false
        savedPitch = mc.player.rotationPitch
        mc.player.rotationPitch = 90f
    }

    override fun onDisable() {
        Main.tickManager.syncTimer()
        mc.player.rotationPitch = savedPitch
    }

    fun interactTrapdoor(vec: Vec3d?) {
        mc.playerController.processRightClickBlock(mc.player, mc.world, pos!!, EnumFacing.UP, vec!!, EnumHand.MAIN_HAND)
    }
}