package dev.zprestige.fire.module.exploit.chorusmanipulator;

import dev.zprestige.fire.Main;
import dev.zprestige.fire.newbus.EventListener;
import dev.zprestige.fire.newbus.events.PacketEvent;
import net.minecraft.network.play.server.SPacketPlayerPosLook;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Vec3d;

public class PacketReceiveListener extends EventListener<PacketEvent.PacketReceiveEvent, ChorusManipulator> {

    public PacketReceiveListener(final ChorusManipulator chorusManipulator){
        super(PacketEvent.PacketReceiveEvent.class, chorusManipulator);
    }

    @Override
    public void invoke(final Object object){
        final PacketEvent.PacketReceiveEvent event = (PacketEvent.PacketReceiveEvent) object;
        if (module.chorussed) {
            if (event.getPacket() instanceof SPacketPlayerPosLook) {
                final SPacketPlayerPosLook packet = (SPacketPlayerPosLook) event.getPacket();
                module.pos = new BlockPos(packet.getX(), packet.getY(), packet.getZ());
                if (module.rotateOnChorus.GetSwitch()) {
                    final float[] rotations = Main.rotationManager.calculateAngle(new Vec3d(packet.getX(), packet.getY() + 1, packet.getZ()));
                    Main.rotationManager.setClientRotations(rotations[0], rotations[1]);
                }
                packet.yaw = mc.player.rotationYaw;
                packet.pitch = mc.player.rotationPitch;
                event.setCancelled();
            }
        }
    }
}
