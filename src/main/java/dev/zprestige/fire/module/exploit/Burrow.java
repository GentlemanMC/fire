package dev.zprestige.fire.module.exploit;

import dev.zprestige.fire.Main;
import dev.zprestige.fire.events.eventbus.annotation.RegisterListener;
import dev.zprestige.fire.events.impl.TickEvent;
import dev.zprestige.fire.module.Module;
import dev.zprestige.fire.util.impl.BlockUtil;
import net.minecraft.init.Blocks;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.MathHelper;

import java.util.Random;

public class Burrow extends Module {
    protected BlockPos pos;

    @Override
    public void onEnable() {
        pos = BlockUtil.getPosition();
    }

    @RegisterListener
    public void onTick(final TickEvent event) {
        final int slot = Main.inventoryManager.getBlockFromHotbar(Blocks.OBSIDIAN);
        if (slot != -1) {
            mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 0.41999998688698, mc.player.posZ, true));
            mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 0.7531999805211997, mc.player.posZ, true));
            mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 1.00133597911214, mc.player.posZ, true));
            mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 1.16610926093821, mc.player.posZ, true));
            Main.interactionManager.placeBlockWithSwitch(pos, true, true, false, slot);
            for (int i = 0; i < 100; i++) {
                mc.player.connection.sendPacket(new CPacketPlayer.Rotation(getRandom(), getRandom(), mc.player.onGround));
            }
        }
        disableModule();

    }

    protected final Random random = new Random();

    protected float getRandom() {
        return MathHelper.clamp(0 + random.nextFloat() * 360, 0, 360);
    }
}
