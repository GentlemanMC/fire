package dev.zprestige.fire.module.exploit.choruspredict;

import dev.zprestige.fire.Main;
import dev.zprestige.fire.event.bus.EventListener;
import dev.zprestige.fire.event.impl.FrameEvent;
import dev.zprestige.fire.manager.playermanager.PlayerManager;
import dev.zprestige.fire.util.impl.BlockUtil;
import dev.zprestige.fire.util.impl.RenderUtil;
import net.minecraft.util.math.AxisAlignedBB;
import net.minecraft.util.math.Vec3d;

import java.util.HashMap;
import java.util.Map;

public class Frame3DListener extends EventListener<FrameEvent.FrameEvent3D, ChorusPredict> {

    public Frame3DListener(final ChorusPredict chorusPredict) {
        super(FrameEvent.FrameEvent3D.class, chorusPredict);
    }

    @Override
    public void invoke(final Object object) {
        for (final Map.Entry<Vec3d, Long> entry : new HashMap<>(module.chorusMap).entrySet()) {
            if (System.currentTimeMillis() - entry.getValue() > module.stayTime.GetSlider() * 1000) {
                module.chorusMap.remove(entry.getKey());
                continue;
            }
            final Vec3d min = entry.getKey();
            final AxisAlignedBB bb = mc.player.getEntityBoundingBox();
            final Vec3d size = new Vec3d(bb.maxX - bb.minX, bb.maxY - bb.minY, bb.maxZ - bb.minZ);
            final AxisAlignedBB bb1 = new AxisAlignedBB(min.x, min.y, min.z, min.x + size.x, min.y + size.y, min.z + size.z);
            if (module.box.GetSwitch()) {
                RenderUtil.drawBBBoxWithHeight(bb1, module.boxColor.GetColor(), 1);
            }
            if (module.outline.GetSwitch()) {
                RenderUtil.drawBlockOutlineBBWithHeight(bb1, module.outlineColor.GetColor(), module.outlineWidth.GetSlider(), 1);
            }
        }
    }
}
